# ⚡ 시스템 설계 - 캐시 계층 (Cache Layer)

**캐시(Cache)** 는 자주 사용하는 데이터를 임시 저장해 빠르게 불러오는 기술입니다.  
**속도 향상 + 부하 감소**를 위해 시스템 아키텍처에서 **계층적으로 사용**됩니다.

---

## 1️⃣ 캐시 계층(Cache Layer)이란?

| 항목       | 설명 |
|------------|------|
| **정의**   | **서버, 애플리케이션, DB 등 다양한 위치에 데이터를 임시 저장**하여 응답 속도 향상 및 부하 감소를 도모하는 계층 구조 |
| **목적**   | 데이터 요청 시, **느린 계층(예: DB)** 까지 가지 않고 빠르게 응답 |
| **결과**   | 응답 지연(latency) 감소, 시스템 처리량 향상, 비용 절감 |

---

## 2️⃣ 캐시 위치에 따른 분류

| 위치            | 설명 |
|------------------|------|
| **클라이언트 측 캐시** | 브라우저 캐시, 앱 내 캐시 (ex. 이미지, HTML 등) |
| **CDN 캐시**         | 지리적으로 가까운 서버에 정적 파일 저장 (전 세계 분산) |
| **웹 서버 캐시**     | Nginx 등에서 reverse proxy 캐시 사용 |
| **애플리케이션 캐시** | 서버 메모리 or Redis 등으로 API 응답 결과 캐싱 |
| **DB 캐시**          | DB 내부 쿼리 결과 캐시, buffer pool |
| **OS/디스크 캐시**   | 파일 시스템 or 하드웨어 수준의 I/O 캐시 |

---

## 3️⃣ 캐시 계층 구조 예시

```
[클라이언트]
   ↓ (브라우저 캐시)
[CDN - Cloudflare, Akamai]
   ↓ (정적 캐시)
[웹 서버 캐시 - Nginx]
   ↓ (동적 페이지 캐시)
[애플리케이션 캐시 - Redis, Memcached]
   ↓
[DB - MySQL, MongoDB]
```

---

## 4️⃣ 캐시 저장소 종류

| 저장소       | 특징 |
|--------------|------|
| **Memory (RAM)** | 빠른 속도, 휘발성 (Redis, Memcached) |
| **디스크 캐시** | 영속성 보장, 속도 느림 (CDN, 로컬 캐시) |
| **하이브리드**   | RAM + 디스크 혼합 저장 방식 (예: Redis with persistence) |

---

## 5️⃣ 캐시 만료/무효화 정책

| 정책명       | 설명 |
|--------------|------|
| **TTL (Time-To-Live)** | 일정 시간 경과 시 캐시 자동 만료 |
| **LRU (Least Recently Used)** | 가장 오래 안 쓰인 항목 제거 |
| **LFU (Least Frequently Used)** | 사용 빈도가 가장 낮은 항목 제거 |
| **Manual Invalidate** | DB 변경 시 캐시 직접 삭제 (ex. 게시글 수정) |
| **Write-through / Write-back** | 캐시 → DB 동기화 방식 결정 |

---

## 6️⃣ 캐시 계층의 장단점

| 장점                            | 단점 |
|---------------------------------|------|
| 응답 속도 향상                 | 캐시 일관성 유지 어려움 |
| 트래픽/DB 부하 감소             | 저장 공간 제한 |
| 비용 절감 (CDN/캐시가 DB보다 싸다) | TTL 설정이 까다로움 |
| 고가용성 구조 구성 가능          | 캐시 오염(Cache Pollution) 가능성 |

---

## 7️⃣ 캐시가 특히 효과적인 경우

- 자주 조회되지만 변경이 적은 데이터 (ex. 피드, 인기 게시물)  
- 외부 API 응답 결과 저장  
- 로그인한 유저 정보 (프로필, 권한 등)  
- 정적 리소스 (이미지, JS, CSS, HTML)

---

## 🎯 정리 요약

✔ **캐시 계층은 응답 속도와 성능 최적화를 위한 핵심 구조**  
✔ 다양한 위치에서 작동: 클라이언트, CDN, 서버, 애플리케이션, DB  
✔ TTL, LRU, LFU 등 캐시 관리 정책을 적절히 설정  
✔ 데이터 특성과 사용 패턴에 따라 **적절한 위치와 방식으로 캐시 설계** 필요  

