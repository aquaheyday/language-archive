# 📬 시스템 설계 - 메시지 큐 (Message Queue)

**메시지 큐(Message Queue)** 는 **비동기 통신을 위한 중간 매개체**로, 생산자(Producer)가 보낸 메시지를 **큐(Queue)** 에 저장해 소비자(Consumer)가 나중에 처리할 수 있도록 해줍니다.

---

## 1️⃣ 메시지 큐란?

| 항목     | 설명 |
|----------|------|
| **정의** | 시스템 간 **비동기 메시지 전송**을 위한 큐 기반의 미들웨어 |
| **목적** | 서비스 간 느슨한 결합, 비동기 처리, 부하 완화, 신뢰성 보장 |
| **결과** | **장애 격리**, **확장성 향상**, **비동기 워크플로우 구성** 가능

---

## 2️⃣ 메시지 큐의 구성 요소

| 구성 요소     | 설명 |
|----------------|------|
| **Producer**   | 메시지를 보내는 주체 (ex. 주문 처리 요청) |
| **Queue**      | 메시지를 저장하는 버퍼 공간 |
| **Consumer**   | 메시지를 읽고 처리하는 주체 |
| **Broker**     | 큐 시스템 자체 (ex. Kafka, RabbitMQ 등) |
| **Topic / Channel** | 메시지를 분류/구독하기 위한 논리적 단위 (Pub/Sub 구조에서 사용) |

---

## 3️⃣ 메시지 큐 동작 방식

```text
[Producer]           # 메시지를 생성하고 보냄
     |
     v
[Message Queue]      # 메시지를 임시 저장 (비동기 버퍼 역할)
     |
     v
[Consumer]           # 큐에서 메시지를 꺼내어 처리
```

- 생산자와 소비자는 **비동기적으로 동작**
- 큐는 **일시 저장소 역할**을 하며, 소비자가 처리할 준비가 될 때까지 메시지를 보관

---

## 4️⃣ 메시지 큐의 장점

| 장점                           | 설명 |
|--------------------------------|------|
| **비동기 처리**                 | 실시간 응답 없이 백그라운드 작업 처리 |
| **부하 분산**                   | 트래픽 폭주 시에도 큐에 저장 후 순차 처리 |
| **서비스 간 결합도 감소**       | 서로 독립적인 서비스 간 통신 가능 |
| **확장성 향상**                 | 소비자 수 늘려 병렬 처리 가능 |
| **장애 격리**                   | 소비자 다운 시에도 메시지 유실 없이 보존 가능 |

---

## 5️⃣ 메시지 큐의 단점

| 단점                           | 설명 |
|--------------------------------|------|
| **복잡도 증가**                | 큐 운영 및 장애 대응, 메시지 중복 처리 등 |
| **지연 가능성**                 | 실시간성 필요한 작업에는 부적합 |
| **메시지 순서 보장 어려움**     | 멀티 컨슈머 처리 시 순서가 뒤바뀔 수 있음 |
| **모니터링/오류 대응 필요**     | 메시지 유실, 지연 등 문제 파악 어려움

---

## 6️⃣ 메시지 큐의 사용 사례

- 이메일/SMS 전송
- 주문/결제 처리 후 후속 작업 (포인트 적립, 알림 등)
- 영상 업로드 → 변환 작업
- 로그 수집 및 이벤트 스트리밍
- IoT 디바이스 데이터 수집
- 마이크로서비스 간 이벤트 통신 (Event-Driven Architecture)

---

## 7️⃣ 주요 메시지 큐 기술

| 기술       | 특징 |
|------------|------|
| **RabbitMQ** | 전통적인 메시지 브로커, AMQP 기반, 신뢰성 높음 |
| **Apache Kafka** | 대규모 스트리밍/로그 처리에 특화, 고성능 |
| **Amazon SQS** | AWS 관리형 서비스, 서버리스 큐 |
| **Redis Streams** | Redis 기반 메시지 스트림 처리 |
| **NATS** | 경량 메시징 시스템, 마이크로서비스용 |
| **Google Pub/Sub** | GCP 기반 확장성 높은 메시지 큐 |

---

## 8️⃣ 메시지 처리 방식

| 방식                  | 설명 |
|-----------------------|------|
| **At Most Once**      | 최대 1번 처리 (유실 가능) |
| **At Least Once**     | 최소 1번 처리 (중복 가능) |
| **Exactly Once**      | 정확히 1번 처리 (복잡하지만 이상적) |

---

## 🎯 정리 요약

✔ 메시지 큐는 시스템 간 **비동기 통신과 처리 안정성 확보를 위한 핵심 컴포넌트**  
✔ **생산자-큐-소비자 구조**를 통해 부하 완화, 장애 격리, 비동기 처리 가능  
✔ Kafka, RabbitMQ, SQS 등 사용 사례에 따라 선택  
✔ 메시지 중복, 순서 보장 등 설계 시 고려 사항 존재

