# 🧠 시스템 설계 - 용량 계획 (Capacity Planning)

**용량 계획(Capacity Planning)** 은 예상되는 트래픽과 서비스 사용량을 기반으로 **적절한 시스템 자원(CPU, 메모리, 스토리지, 네트워크 등)** 을 미리 산정하는 과정입니다.

---

## 1️⃣ 용량 계획이란?

| 항목       | 설명 |
|------------|------|
| **정의**   | 서비스에 필요한 **자원 규모를 미리 계산**하여, **성능 저하나 장애 없이** 서비스를 운영할 수 있도록 준비하는 것 |
| **목적**   | 트래픽 증가에도 버틸 수 있는 인프라 구성, 비용 최적화, 장애 예방 |
| **타이밍** | 시스템 초기 설계, 기능 확장, 트래픽 증가 예측 시 수행 |

---

## 2️⃣ 주요 대상 자원

| 자원           | 설명 |
|----------------|------|
| **CPU**        | 요청 처리 성능 (ex. QPS 대비 필요한 vCPU 수) |
| **메모리(RAM)** | 캐시, 프로세스 처리, 버퍼 등 |
| **스토리지**   | 데이터 저장 (DB, 로그, 이미지 등) |
| **네트워크**   | 트래픽 전송 속도 및 대역폭 |
| **DB Connection** | 동시 처리 가능한 연결 수 |

---

## 3️⃣ 용량 계획 절차

1. 트래픽 추정 (DAU, QPS, 저장량 등)
2. 자원 단위당 처리량 측정 (벤치마크 or 경험 기반)
3. 사용량 계산 = 요청 수 × 단위 처리 자원
4. 여유 버퍼(30~50%) 포함한 계획 수립
5. 수평/수직 확장 전략 반영

---

## 4️⃣ 용량 계산 예시 (SNS 서비스)

```txt
📌 전제 조건
- DAU: 100만
- 1인당 요청 수: 20 (하루 2천만 요청)
- 평균 요청 응답 시간 목표: < 200ms
- 1대 서버의 처리 능력: 50 QPS

📌 서버 수 계산
- 전체 QPS: 2천만 ÷ 86,400초 ≈ 231 QPS
- 필요 서버 수 = 231 ÷ 50 ≈ 4.6 → 최소 5대 + 여유분 2대 → **7대 준비**

📌 저장소 용량
- 게시글: 2KB/건, 하루 500만 건 → 10GB/day
- 1년 저장 기준: 10GB × 365 = **3.65TB**

📌 캐시 메모리
- 자주 조회되는 피드: 100만 건, 1건 2KB → 2GB
- Redis 여유 고려 → **4GB 이상 권장**

📌 네트워크 대역폭
- 이미지 300KB × 100만 유저 = 300GB/day
- 초당 평균 트래픽 = 300GB ÷ 86,400초 ≈ **3.47MB/s**
```

---

## 5️⃣ 고려해야 할 요소들

| 요소              | 설명 |
|-------------------|------|
| **트래픽 피크 시간** | 평균이 아닌 **최대 트래픽 기준**으로 설계 |
| **여유 버퍼**       | 30~50%의 **스파이크 대비 여유분** 확보 |
| **성능 테스트**     | 실제 트래픽 시뮬레이션으로 예측 정확도 향상 |
| **수평 확장성 고려** | 자원 부족 시 노드 추가로 확장 가능하도록 설계 |
| **캐시와 CDN 활용** | 백엔드 부하를 줄이기 위한 전략 포함 |

---

## 6️⃣ 도구 & 실무 팁

| 항목     | 설명 |
|----------|------|
| **벤치마크 툴** | Apache Bench, JMeter, k6 등으로 처리량 측정 |
| **모니터링** | Prometheus, Grafana, CloudWatch 등으로 추세 예측 |
| **클라우드 활용** | Auto Scaling, Spot Instances로 유연한 대응 가능 |
| **비용 분석** | 자원당 단가 계산 후 비용 대비 효율 비교 필수 |

---

## 🎯 정리 요약

✔ 용량 계획은 **서비스 안정성과 비용 최적화**를 동시에 달성하기 위한 핵심 작업  
✔ 트래픽 추정을 기반으로 **CPU, 메모리, 저장소, 네트워크 용량 계산**  
✔ **여유분 확보 + 확장성 고려 + 실측 테스트**가 필수  
✔ 제대로 된 계획 없이는 서비스 장애, 과금 폭탄, 성능 저하 발생 가능
