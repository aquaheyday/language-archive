# 🧭 시스템 설계 - 레이트 리미팅 (Rate Limiting)

**레이트 리미팅(Rate Limiting)** 은 일정 시간 동안 허용된 요청 수를 제한하여  
시스템 자원 보호, 악성 트래픽 방지, 공정한 서비스 제공 등을 위해 사용하는 **트래픽 제어 기술**입니다.

---

## 1️⃣ 레이트 리미팅이란?

| 항목     | 설명 |
|----------|------|
| **정의** | 클라이언트가 단위 시간 내에 보낼 수 있는 요청 횟수를 제한하는 기술 |
| **목적** | - 시스템 과부하 방지<br>- 서비스 품질 유지<br>- 악성 사용자 제어<br>- 공정한 리소스 분배 |
| **사용 위치** | API Gateway, Load Balancer, Web Server, NGINX, 프록시, 클라이언트 앱 등 |

---

## 2️⃣ 주요 적용 방식

| 방식              | 설명 |
|-------------------|------|
| **IP 기반 제한**      | 클라이언트 IP 주소 단위로 요청 수 제한 |
| **API Key 기반 제한** | 사용자별/앱별 인증키 단위 제한 |
| **엔드포인트 기반 제한** | 요청 URL 단위로 다르게 제한 가능 |
| **사용자 등급 기반 제한** | 유료/무료 사용자에 따라 제한 속도 다르게 설정 |

---

## 3️⃣ 주요 알고리즘

| 알고리즘             | 설명 |
|----------------------|------|
| **Fixed Window**     | 일정 시간 구간 내 요청 수 체크 (예: 매 1분마다 100개) |
| **Sliding Window**   | 요청 간격을 시간 단위로 밀면서 체크 → 더 정확한 제어 |
| **Token Bucket**     | 버킷에 토큰을 주기적으로 채우고, 요청마다 하나씩 소모 (Burst 가능) |
| **Leaky Bucket**     | 일정 속도로만 요청을 처리 → 트래픽 평준화 효과 |

---

### 📌 알고리즘 비교

| 항목           | Fixed Window | Sliding Window | Token Bucket | Leaky Bucket |
|----------------|--------------|----------------|---------------|---------------|
| 설정 간단함      | ✅           | ❌             | ✅            | ✅            |
| 부드러운 흐름 제어 | ❌           | ✅             | ✅            | ✅            |
| 버스트 처리 가능  | ❌           | ❌             | ✅            | ❌            |
| 정밀 제어        | ❌           | ✅             | ✅            | ✅            |

---

## 4️⃣ 실전 적용 예시

| 시스템          | 적용 방식 |
|-----------------|-----------|
| **NGINX**        | `limit_req` 모듈로 IP별 요청 수 제한 |
| **API Gateway**  | 사용자/API Key 기반 레이트 리미팅 정책 설정 |
| **Cloudflare**   | IP, 국가, URL 패턴 단위로 속도 제한 |
| **GitHub API**   | 토큰 기준으로 초당/분당 요청 수 제한 |
| **Kubernetes Ingress** | 애드온 또는 서비스 메시로 제한 설정 가능 |

---

## 5️⃣ 주의사항 및 팁

- **Rate Limit 초과 시 응답 코드**: 보통 `429 Too Many Requests` 사용
- **사용자 알림**: 헤더에 `X-RateLimit-Limit`, `X-RateLimit-Remaining` 등으로 안내
- **Redis 활용**: 중앙화된 카운터 저장소로 빠르고 확장 가능한 제어 가능
- **지속적 요청 초과 시 차단**: 일정 시간 블록하거나, CAPTCHA 유도

---

## 🎯 정리 요약

✔ **레이트 리미팅**은 시스템 보호와 공정한 사용을 위한 **요청 속도 제한 기술**  
✔ IP, 사용자, API Key 등 다양한 기준으로 적용 가능  
✔ **Token Bucket**과 **Sliding Window** 방식이 실전에서 널리 사용됨  
✔ **429 응답 코드 + 안내 헤더**로 사용자에게 제한 상황 전달  
✔ Redis, NGINX, API Gateway 등 다양한 레벨에서 구현 가능

