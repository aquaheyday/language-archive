# ⚖️ 시스템 설계 - 로드 밸런서 (Load Balancer)

**로드 밸런서(Load Balancer)** 는 트래픽을 여러 서버에 **고르게 분산**시켜 시스템의 **가용성(Availability)**, **확장성(Scalability)**, **신뢰성(Reliability)** 을 향상시키는 컴포넌트입니다.

---

## 1️⃣ 로드 밸런서란?

| 항목     | 설명 |
|----------|------|
| **정의** | 다수의 서버로 트래픽을 분산하여 **하나의 시스템처럼 동작**하도록 만드는 네트워크 구성 요소 |
| **목적** | **특정 서버에 과부하를 방지**하고, 장애 발생 시에도 시스템을 안정적으로 유지 |
| **결과** | 고가용성, 수평 확장(Scale-out), 성능 향상, 장애 허용성 향상 |

---

## 2️⃣ 로드 밸런싱 방식

| 방식                | 설명 |
|---------------------|------|
| **L4 (전송 계층)**   | IP/Port 기반 분산 (ex. TCP/UDP) – 빠르지만 단순 |
| **L7 (애플리케이션 계층)** | HTTP/HTTPS 기반, URL/헤더/쿠키 등 컨텍스트 고려한 분산 |
| **DNS 기반**        | 도메인 수준에서 트래픽 분산 (CDN처럼 전세계적으로) |

---

## 3️⃣ 로드 밸런싱 알고리즘

| 알고리즘               | 설명 |
|------------------------|------|
| **Round Robin**        | 순차적으로 서버에 분산 |
| **Least Connections**  | 연결 수가 가장 적은 서버 선택 |
| **IP Hash**            | 클라이언트 IP 기반 고정 서버 매핑 |
| **Weighted Round Robin** | 가중치를 고려한 순차 분산 |
| **Consistent Hashing** | 분산 캐시나 세션 서버에 자주 사용 – 서버 변경 시 영향 최소화 |

---

## 4️⃣ 로드 밸런서 구조 예시

```text

                           ┌─────────────────────┐
                           │     클라이언트         │
                           └─────────────────────┘
                                      │
                                      ▼
                           ┌─────────────────────┐
                           │   로드 밸런서 (L4/L7)  │
                           └─────────────────────┘
                              │      │       │
               ┌──────────────┘      │       └──────────────┐
               ▼                     ▼                      ▼
     ┌────────────────┐   ┌────────────────┐     ┌────────────────┐
     │    서버 #1      │    │    서버 #2     │ ...  │    서버 #N     │
     └────────────────┘   └────────────────┘     └────────────────┘
               │                     │                      │
               ▼                     ▼                      ▼
        ┌────────────┐       ┌────────────┐        ┌────────────┐
        │ DB / Cache │  ...  │ DB / Cache │   ...  │ DB / Cache │
        └────────────┘       └────────────┘        └────────────┘

```
---

## 5️⃣ 로드 밸런서 유형

| 유형              | 설명 |
|-------------------|------|
| **하드웨어 LB**     | F5, Cisco 등 고성능 장비 – 비용 높음 |
| **소프트웨어 LB**   | HAProxy, Nginx, Envoy 등 – 유연하고 저렴 |
| **클라우드 LB**     | AWS ELB, GCP Load Balancer – 관리형, 자동 확장 |
| **DNS 기반 LB**     | Route 53, Cloudflare – 지리적 분산에 효과적 |

---

## 6️⃣ 헬스 체크 (Health Check)

| 항목        | 설명 |
|-------------|------|
| **정기적 점검** | 서버의 상태를 주기적으로 확인 (Ping, HTTP 요청 등) |
| **장애 감지**   | 서버 응답 없음 → 자동으로 트래픽 제외 |
| **고가용성 유지** | 트래픽을 살아있는 서버에만 분산하여 중단 없는 서비스 제공 |

---

## 7️⃣ 로드 밸런서와 세션 관리

| 방법              | 설명 |
|-------------------|------|
| **Sticky Session** | 클라이언트 ↔ 서버 간 연결 유지 (세션 기반 서비스에 필요) |
| **세션 스토리지 공유** | Redis, DB에 세션 저장 → 어떤 서버든 처리 가능 |
| **JWT 사용**        | Stateless 인증 → Sticky Session 불필요 |

---

## 8️⃣ 장단점 정리

| 장점                              | 단점 |
|-----------------------------------|------|
| 트래픽 분산으로 성능/가용성 향상       | 복잡성 증가 |
| 장애 대응 가능 (Failover)          | 잘못된 구성 시 오히려 병목 발생 가능 |
| 수평 확장 구조 지원 (Scale-out 용이) | 클라이언트 IP 공유 문제 (프록시 뒤에 숨겨짐 등) |
| 보안 기능 포함 가능 (HTTPS 종료 등)  | 비용 발생 (특히 클라우드/하드웨어 LB) |

---

## 🎯 정리 요약

✔ **로드 밸런서는 서버 간 부하를 분산시켜 시스템 안정성과 확장성을 보장**  
✔ L4/L7 레벨 선택은 트래픽 성격에 따라 다르게 구성  
✔ 알고리즘, 세션 관리, 헬스 체크 등 세부 전략 중요  
✔ 클라우드 환경에서는 관리형 로드 밸런서를 적극 활용 가능
