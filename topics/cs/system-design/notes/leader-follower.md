# 🧭 시스템 설계 - 리더-팔로워 패턴 (Leader-Follower Pattern)

**리더-팔로워 패턴**은 분산 시스템에서 **리더 노드가 쓰기를 전담하고, 팔로워 노드가 읽기를 분산 처리**하는 구조입니다.  
데이터 일관성을 유지하면서도 성능과 확장성을 높일 수 있는 대표적인 아키텍처 중 하나입니다.

---

## 1️⃣ 리더-팔로워 패턴이란?

| 항목     | 설명 |
|----------|------|
| **정의** | 하나의 리더 노드가 모든 쓰기 요청을 처리하고, 복제된 팔로워 노드들이 읽기 요청을 처리하는 구조 |
| **목적** | **일관성 유지, 읽기 성능 향상, 장애 복구 용이성 확보** |
| **적용 사례** | Redis Sentinel, Kafka, MySQL Replication, ZooKeeper 등 |

---

## 2️⃣ 구조와 동작 방식

- **쓰기 요청**: 항상 **리더 노드**에게 전달 → 리더가 데이터 처리 후 팔로워에게 복제 전파  
- **읽기 요청**: **팔로워 노드**가 처리하여 부하 분산  
- **복제 방식**: 리더가 변경 사항을 팔로워에게 **비동기 또는 동기 복제**

```
[클라이언트] ─── 쓰기 요청 ──▶ [리더 노드]
                                   │
                             (데이터 변경)
                                   │
                             ▼ 복제 전파
                    ┌────────────┬────────────┐
                    ▼            ▼            ▼
               [팔로워 1]     [팔로워 2]    [팔로워 3]
                    ▲            ▲            ▲
             읽기 응답 ◀── 읽기 요청 ── [클라이언트]

```

---

## 3️⃣ 장점과 단점

| 항목       | 설명 |
|------------|------|
| ✅ **장점** | - 읽기 성능 향상 (읽기 분산)<br>- 리더 기준으로 일관성 관리 용이<br>- 장애 시 리더 교체로 빠른 복구 가능 |
| ❌ **단점** | - 리더에 쓰기 병목 발생<br>- 팔로워가 리더의 최신 상태를 항상 반영하지 않을 수 있음 (지연 복제)<br>- 리더 장애 시 일시적 쓰기 중단 가능 |

---

## 4️⃣ 리더-팔로워 vs 기타 구조 비교

| 구조                | 특징 |
|---------------------|------|
| **리더-팔로워**       | 일관성 중심, 쓰기 집중, 읽기 확장 |
| **멀티마스터 구조**   | 모든 노드가 읽기/쓰기 가능, 충돌 처리 필요 |
| **피어 투 피어(P2P)** | 중앙 리더 없이 각 노드가 동등, 복잡성 증가 |
| **샤딩 구조**         | 데이터 파티셔닝 중심, 리더/팔로워 혼합 가능 |

---

## 5️⃣ 장애 처리: 리더 선출 (Leader Election)

- **리더 장애 발생 시**:
  - 팔로워 중 하나를 새로운 리더로 선출 (예: ZooKeeper, Raft 알고리즘)
  - 클라이언트는 새로운 리더에게 쓰기 요청 재전송
- **선출 방법 예시**:
  - 우선순위 기반 (ID, 랭크)
  - 타임아웃 감지 + 투표 기반 (Raft, Paxos)

---

## 6️⃣ 실전 적용 예시

| 시스템              | 리더-팔로워 역할 설명 |
|---------------------|------------------------|
| **Kafka**           | 파티션당 리더 브로커가 쓰기 담당, 팔로워는 복제 수행 |
| **Redis Sentinel**  | 리더 장애 감지 후 자동 페일오버 |
| **MySQL Replication** | Master-Slave 구조 (쓰기: 마스터, 읽기: 슬레이브) |
| **ZooKeeper**       | 리더가 상태 변경 처리, 팔로워는 읽기 처리 |

---

## 🎯 정리 요약

✔ **리더-팔로워 패턴**은 리더가 쓰기, 팔로워가 읽기를 처리해 **일관성 + 읽기 성능**을 동시에 확보  
✔ 읽기 확장성에 유리하지만, **리더 병목**과 **지연 복제**에 주의 필요  
✔ 장애 대응을 위해 **리더 선출 메커니즘** 반드시 설계 필요  
✔ Redis, Kafka, MySQL 등 다양한 실전 시스템에서 널리 사용됨
