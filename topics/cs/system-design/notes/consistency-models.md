# 🧭 시스템 설계 - 일관성 모델 (Consistency Models)

**일관성 모델**은 분산 시스템에서 **데이터 복제본 간에 어떤 일관성을 보장할 것인지 정의하는 규칙**입니다.  
강한 일관성부터 느슨한 일관성까지 다양한 모델이 존재하며, 사용자의 요구 사항에 따라 적절한 모델을 선택해야 합니다.

---

## 1️⃣ 일관성 모델이란?

| 항목       | 설명 |
|------------|------|
| **정의**   | 분산 시스템에서 복제된 데이터가 사용자에게 어떻게 보일지를 정의하는 규칙 |
| **목적**   | 데이터 일관성과 시스템 성능 사이의 균형을 맞추기 위함 |
| **관련 개념** | **CAP 이론의 Consistency**, 데이터 복제, 읽기/쓰기 보장 등 |

---

## 2️⃣ 주요 일관성 모델 종류

| 모델명                 | 설명 |
|------------------------|------|
| **강한 일관성 (Strong Consistency)** | 모든 노드에서 **항상 동일한 최신 데이터**를 보장. 쓰기가 완료되면 모든 읽기는 그 결과를 반영함 |
| **선형 일관성 (Linearizability)** | 강한 일관성 + 실시간 순서를 보장. 실제 시간 흐름대로 읽기/쓰기가 발생한 것처럼 보임 |
| **순차 일관성 (Sequential Consistency)** | 쓰기 순서를 **논리적 순서**로만 보장. 실제 시간은 무시되며 사용자 시점에서 순서가 맞아야 함 |
| **약한 일관성 (Weak Consistency)** | 쓰기 후 **일정 시간 후에 일관성 보장**, 즉시 읽으면 최신이 아닐 수 있음 |
| **최종 일관성 (Eventual Consistency)** | 일정 시간이 지나면 **모든 노드가 결국 동일한 상태로 수렴** (예: DNS, DynamoDB) |
| **세션 일관성 (Session Consistency)** | 클라이언트 세션 내에서는 일관성 보장, 세션이 달라지면 약한 일관성 |
| **캐쥬얼 일관성 (Causal Consistency)** | **인과관계 있는 작업들만 순서를 보장**, 독립된 작업 간 순서는 무시 |

---

## 3️⃣ 일관성 모델 비교

| 모델                 | 읽기 일관성 | 쓰기 지연 | 사용 예시 |
|----------------------|-------------|-----------|-----------|
| 강한 일관성          | 매우 높음   | 높음      | RDB, Zookeeper |
| 선형 일관성          | 매우 높음   | 높음      | Raft, Paxos |
| 순차 일관성          | 높음        | 중간      | 일부 메모리 모델 |
| 최종 일관성          | 낮음        | 낮음      | Cassandra, DynamoDB |
| 세션 일관성          | 세션 내 보장 | 낮음     | 모바일 앱 |
| 캐쥬얼 일관성        | 중간        | 낮음      | 소셜 피드 시스템 등 |

---

## 4️⃣ 일관성 vs 성능: 트레이드오프

- **강한 일관성**: 데이터 신뢰성 높지만 **지연(latency)** 증가  
- **최종 일관성**: 빠른 응답 가능하지만 최신 데이터 보장 어려움  
- 실시간 서비스(예: 은행)는 강한 일관성이 필요하고, SNS 피드나 로그 수집 시스템은 최종 일관성으로 충분함

---

## 5️⃣ 실전에서의 선택 기준

| 조건                     | 추천 모델               |
|--------------------------|-------------------------|
| 은행, 결제 시스템         | 강한 일관성              |
| 대규모 SNS 피드 시스템   | 최종 일관성 or 캐쥬얼 일관성 |
| 쇼핑몰 장바구니 기능      | 세션 일관성              |
| 협업 문서, 게임 상태 동기화 | 순차 or 선형 일관성         |

---

## 🎯 정리 요약

✔ **일관성 모델**은 분산 시스템의 복제된 데이터에 대한 **동기화 정도**를 정의  
✔ 강한 일관성은 정확성 보장, 최종 일관성은 성능/확장성 우선  
✔ **사용 목적에 따라 모델을 적절히 선택하는 것이 핵심**  
✔ 일관성과 성능 사이에는 필연적인 **트레이드오프** 존재
