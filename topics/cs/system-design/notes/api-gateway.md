# 🌐 시스템 설계 - API 게이트웨이 (API Gateway)

**API 게이트웨이**는 클라이언트와 백엔드 서비스 사이에서 **중앙 진입점 역할**을 하는 컴포넌트입니다.  
요청 라우팅, 인증, 로깅, 트래픽 제어 등 다양한 기능을 수행하여 **마이크로서비스 아키텍처에서 핵심 역할**을 합니다.

---

## 1️⃣ API 게이트웨이란?

| 항목     | 설명 |
|----------|------|
| **정의** | 클라이언트 요청을 백엔드 서비스로 전달하고, 응답을 중계하는 **프록시 서버** |
| **역할** | 라우팅, 인증/인가, 속도 제한, 로깅, 응답 조합 등 |
| **중요성** | **마이크로서비스 아키텍처의 통합 관문** 역할 수행 |

---

## 2️⃣ API 게이트웨이의 주요 기능

| 기능                   | 설명 |
|------------------------|------|
| **라우팅 (Routing)**       | 요청 URL, 메서드에 따라 적절한 서비스로 전달 |
| **인증 / 인가**            | JWT, OAuth 등 토큰 검증 및 권한 체크 |
| **속도 제한 (Rate Limiting)** | 과도한 요청 방지, abuse 방지 |
| **로깅 / 모니터링**        | 요청/응답 로그 기록 및 성능 지표 수집 |
| **응답 조합 (Aggregation)** | 여러 서비스의 응답을 하나로 조합 |
| **CORS 처리**             | 다른 도메인에서의 요청 허용/차단 설정 |
| **API 버전 관리**         | /v1, /v2 등 버전별로 라우팅 분리 가능 |

---

## 3️⃣ API 게이트웨이 동작 흐름

```text
[Client Request]                         # 사용자가 보낸 HTTP 요청 (예: POST /users/login)
       |
       v
[API Gateway]                            # 모든 요청이 통과하는 중앙 진입점
       |
       |-- 인증 / 인가 확인                  # JWT, OAuth 토큰 유효성 검사
       |-- 요청 유효성 검증                   # 필수 헤더/파라미터 존재 여부 등 체크
       |-- 속도 제한 (Rate Limiting)         # 요청 수 제한으로 abuse 방지
       |-- 로깅 / 트래픽 모니터링             # 요청 기록 저장, 대시보드 제공
       |-- CORS 처리                          # 교차 도메인 허용 여부 확인
       |
       v
[Service Routing]                        # 요청 URL/메서드 기반으로 내부 마이크로서비스 선택
       |
       |-- 예: /users/login → Auth Service
       |-- 예: /products/list → Product Service
       |
       v
[Target Microservice]                    # 실제 비즈니스 로직 처리 (DB 조회, 연산 등)
       |
       v
[Response]                               # 결과 데이터 or 상태 코드 반환
       |
       v
[API Gateway]
       |
       |-- 응답 포맷 통일 (필요시 변환)
       |-- 로깅 및 응답 속도 기록
       |
       v
[Client Response]                        # 사용자에게 응답 전송 (JSON, HTML, 등)
```

---

## 4️⃣ API 게이트웨이의 장점

| 장점                        | 설명 |
|-----------------------------|------|
| **중앙 집중 관리**           | 인증, 로깅 등 기능을 게이트웨이에서 일괄 처리 |
| **보안 강화**               | 민감한 서비스 보호, 인증 로직 통합 |
| **유연한 라우팅**            | 동적으로 서비스 주소 변경 가능 |
| **API 모니터링 용이**        | 모든 요청을 한 곳에서 추적 가능 |
| **클라이언트와 서비스 간 의존도 감소** | 변경사항을 게이트웨이에서 흡수 가능 |

---

## 5️⃣ API 게이트웨이의 단점

| 단점                          | 설명 |
|-------------------------------|------|
| **단일 장애 지점(SPOF)**        | 게이트웨이 장애 시 전체 서비스 영향 가능 |
| **복잡도 증가**               | 설정, 인증, 로깅 등 다양한 기능 관리 필요 |
| **응답 지연 가능성**          | 인증, 로깅, 포워딩 등 중간 처리 시간 발생 |
| **비용 발생 (클라우드 기반일 경우)** | 사용량 기반 요금 과금 가능성 |

---

## 6️⃣ API 게이트웨이 vs 리버스 프록시

| 항목             | API 게이트웨이                        | 리버스 프록시 (예: Nginx)            |
|------------------|----------------------------------------|---------------------------------------|
| **주요 목적**     | 마이크로서비스 관리                   | 정적/동적 요청 포워딩 |
| **기능**         | 인증, 속도 제한, 로깅, 버전 관리 등     | 단순한 라우팅 및 캐싱 |
| **API 중심**     | O                                     | X (웹서버 기반 라우팅이 많음) |
| **복잡성**       | 상대적으로 높음                        | 상대적으로 단순 |

---

## 7️⃣ 대표 API 게이트웨이 솔루션

| 솔루션             | 특징 |
|--------------------|------|
| **AWS API Gateway**     | 서버리스 기반, Lambda/HTTP 연동, 인증/속도제한 내장 |
| **Kong**                | 오픈소스, 확장성 높음, 플러그인 기반 |
| **Nginx + Lua/OpenResty** | 커스터마이징 자유도 높음 |
| **Apigee (Google)**     | 기업용, 보안/모니터링 강력 |
| **Istio (Service Mesh)**| Envoy 기반, 마이크로서비스 통신/보안 통합 관리 |

---

## 8️⃣ 마이크로서비스와의 연계

- 마이크로서비스는 각기 다른 엔드포인트와 책임을 갖고 있음
- API 게이트웨이가 클라이언트 요청을 **각 서비스로 적절히 분산/관리**
- 게이트웨이 없이 마이크로서비스 직접 연결 시, 보안/버전관리/트래픽 제어 어려움

---

## 🎯 정리 요약

✔ **API 게이트웨이는 마이크로서비스 시스템의 중심 입구 역할**  
✔ 인증, 라우팅, 로깅, 속도 제한 등 다양한 기능을 한 곳에서 처리  
✔ 단일 장애 지점 및 복잡성 증가 등의 단점도 고려 필요  
✔ 클라우드/오픈소스/서비스 메시 등 다양한 형태로 구현 가능
