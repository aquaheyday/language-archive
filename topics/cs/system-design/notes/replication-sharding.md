# 🧭 시스템 설계 - 데이터 복제 & 샤딩

**데이터 복제(Replication)** 와 **샤딩(Sharding)** 은 분산 시스템에서 **확장성, 고가용성, 성능**을 확보하기 위한 핵심 전략입니다.  
복제는 **같은 데이터를 여러 곳에 저장**, 샤딩은 **데이터를 나눠서 저장**하는 방식입니다.

---

## 1️⃣ 데이터 복제 (Replication)

| 항목     | 설명 |
|----------|------|
| **정의** | 하나의 데이터를 **여러 노드에 복사해서 저장**하는 방식 |
| **목적** | 장애 허용성, 가용성, 읽기 성능 향상 |
| **종류** | - **동기 복제**: 모든 복제본이 동일하게 변경될 때까지 쓰기 완료 안 됨<br>- **비동기 복제**: 리더에서 쓰기 완료 후, 나중에 복제본 업데이트 |

### 예시

| 시스템         | 복제 방식          |
|----------------|--------------------|
| Redis Sentinel | 비동기 복제 (리더-팔로워) |
| MySQL          | 마스터-슬레이브 복제     |
| Kafka          | 브로커 복제 (리더-팔로워 구조) |

### 장점 & 단점

| 장점                         | 단점 |
|------------------------------|------|
| ✅ 읽기 처리량 증가            | ❌ 쓰기에는 큰 도움 없음 |
| ✅ 장애 발생 시 빠른 복구 가능 | ❌ 데이터 동기화 지연 가능 |
| ✅ 고가용성 확보              | ❌ 복제 노드 수 증가 시 복잡도 ↑ |

---

## 2️⃣ 샤딩 (Sharding)

| 항목     | 설명 |
|----------|------|
| **정의** | 데이터를 **여러 노드에 나눠 저장**하는 분할 전략 |
| **목적** | 수평 확장 (쓰기/저장 분산), 성능 개선 |
| **기준** | - **해시 샤딩** (user_id % N)<br>- **범위 샤딩** (날짜, ID 범위)<br>- **지역 샤딩** (지리적 분산) |

### 예시

| 시스템          | 샤딩 방식         |
|-----------------|------------------|
| MongoDB         | 범위/해시 샤딩     |
| Cassandra       | 파티션 키 기반 샤딩 |
| Elasticsearch   | 인덱스 기반 샤딩   |

### 장점 & 단점

| 장점                             | 단점 |
|----------------------------------|------|
| ✅ 쓰기 부하 분산 가능             | ❌ 샤딩 키 선택이 매우 중요 |
| ✅ 스토리지 병목 해소              | ❌ 샤드 간 조인/정렬 어려움 |
| ✅ 대용량 데이터 분산 저장 가능     | ❌ 샤드 재배치 복잡도 ↑ |

---

## 3️⃣ 복제 vs 샤딩 비교

| 항목        | 데이터 복제                     | 데이터 샤딩                      |
|-------------|----------------------------------|----------------------------------|
| **데이터 분포** | 모든 노드에 동일한 데이터 저장         | 노드마다 서로 다른 데이터 저장         |
| **주요 목적**   | 고가용성, 읽기 확장, 장애 복구         | 쓰기 확장, 저장 분산                 |
| **읽기 처리**   | 복제본에서 읽기 가능 (분산)           | 샤드에서 직접 읽기                  |
| **쓰기 처리**   | 주로 리더에서 집중 처리               | 여러 샤드로 분산 처리 가능           |

---

## 4️⃣ 실전에서의 조합 전략

> 실제 대규모 시스템은 복제와 샤딩을 **동시에 사용**합니다.

### 📦 예시 구조

- **Cassandra**: 파티션 키로 **샤딩**, 각 파티션은 **복제본 유지**
- **MongoDB**: **샤드 클러스터 + 복제 세트**로 구성
- **Elasticsearch**: 샤딩된 인덱스 구조에 **복제본 추가**

---

## 🎯 정리 요약

✔ **복제(Replication)**: 같은 데이터를 여러 노드에 저장 → **고가용성 + 읽기 성능 증가**  
✔ **샤딩(Sharding)**: 데이터를 분할하여 여러 노드에 저장 → **쓰기 확장 + 스토리지 분산**  
✔ 복제는 **중복 저장**, 샤딩은 **분할 저장**  
✔ 실전에서는 **복제 + 샤딩을 조합**해 사용함
