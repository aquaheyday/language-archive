# 🤝 TCP 3-Way & 4-Way 핸드셰이크

**TCP는 연결 지향형 프로토콜로, 데이터 전송 전후에 연결 설정과 해제를 위한 절차가 필요합니다.**  
이를 위해 **3-Way Handshake(연결 설정)**, **4-Way Handshake(연결 종료)** 과정을 거칩니다.

---

## 1️⃣ 3-Way Handshake (연결 설정)

> 클라이언트와 서버 간에 **신뢰성 있는 연결을 설정**하기 위한 3단계 절차

#### 과정

| 단계 | 송신자      | 수신자      | 설명                         |
|------|-------------|-------------|------------------------------|
| 1    | 클라이언트 → | 서버        | `SYN` 전송 (연결 요청)       |
| 2    | 서버 →       | 클라이언트 | `SYN + ACK` 전송 (수락 응답) |
| 3    | 클라이언트 → | 서버        | `ACK` 전송 (연결 완료)       |

> 연결이 설정되면 양쪽 모두 데이터 전송 가능

#### 예시 흐름 (3-Way Handshake)

```
[클라이언트] ------> SYN ------> [서버]
[클라이언트] <---- SYN+ACK <---- [서버]
[클라이언트] ------> ACK ------> [서버]
```

---

## 2️⃣ 4-Way Handshake (연결 종료)

> TCP 연결을 **양방향으로 안전하게 종료**하기 위한 4단계 절차

#### 과정

| 단계 | 송신자      | 수신자      | 설명                         |
|------|-------------|-------------|------------------------------|
| 1    | 클라이언트 → | 서버        | `FIN` 전송 (종료 요청)       |
| 2    | 서버 →       | 클라이언트 | `ACK` 전송 (요청 수락)       |
| 3    | 서버 →       | 클라이언트 | `FIN` 전송 (서버도 종료 요청)|
| 4    | 클라이언트 → | 서버        | `ACK` 전송 (종료 수락)       |

> 이후 클라이언트는 일정 시간 `TIME_WAIT` 상태 유지

#### 예시 흐름 (4-Way Handshake)

```
[클라이언트] ------> FIN ------> [서버]
[클라이언트] <------ ACK <------ [서버]
[클라이언트] <------ FIN <------ [서버]
[클라이언트] ------> ACK ------> [서버]
```

---

## 3️⃣ TIME_WAIT 상태란?

> 연결 종료 후 클라이언트가 **잠시 대기 상태를 유지하는 이유**

- 지연된 패킷 처리 대비
- 올바른 종료 보장 및 중복 연결 방지
- 약 **2 * MSL(Maximum Segment Lifetime)** 동안 유지

---

## 4️⃣ 연결 설정 & 종료 비교

| 항목         | 3-Way Handshake        | 4-Way Handshake         |
|--------------|------------------------|--------------------------|
| 목적         | 연결 설정               | 연결 종료                 |
| 메시지 수    | 3개                     | 4개                       |
| FIN 사용     | X                      | O                         |
| ACK 포함     | O                      | O                         |
| 데이터 전송   | 설정 완료 후 가능       | 종료 전까지 가능          |

---

## 🎯 정리 요약

✔ **3-Way Handshake**: `SYN → SYN+ACK → ACK` → 연결 수립  
✔ **4-Way Handshake**: `FIN → ACK → FIN → ACK` → 연결 종료  
✔ **TIME_WAIT** 상태로 지연된 패킷 처리 및 안정성 확보  
✔ TCP는 **신뢰성 있는 연결과 종료를 위한 체계적인 절차**를 가짐
