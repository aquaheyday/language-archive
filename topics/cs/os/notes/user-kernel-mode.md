# 👥 사용자 모드 / 🛡️ 커널 모드

**운영체제는 CPU의 권한 수준(Ring Level)을 나눠, 프로그램이 시스템 자원에 함부로 접근하지 못하도록 `모드(Modes)`를 구분합니다.  
대표적으로 사용자 모드(User Mode)와 커널 모드(Kernel Mode)가 있으며, 이 둘은 보안과 안정성을 위한 핵심 개념입니다.**

---

## 1️⃣ 사용자 모드 / 커널 모드란?

| 항목         | 사용자 모드 (User Mode)                   | 커널 모드 (Kernel Mode)                 |
|--------------|--------------------------------------------|------------------------------------------|
| 정의         | 일반 애플리케이션이 실행되는 제한된 권한의 모드 | 운영체제 커널 코드가 실행되는 최상위 권한의 모드 |
| 접근 권한     | 제한적 (하드웨어 직접 접근 불가)               | 전체 자원 접근 가능 (메모리, 디바이스 등)     |
| 용도         | 사용자 앱 실행, 게임, 편집기 등               | 시스템 자원 제어, 시스템 콜 처리 등       |
| 전환 방법     | 시스템 콜 호출, 인터럽트 발생 시 전환           | 작업 완료 후 사용자 모드로 복귀            |
| 안정성       | 높음 (장애가 발생해도 시스템 전체 영향 작음)      | 낮음 (오류 발생 시 시스템 전체 다운 가능)     |

---

## 2️⃣ 왜 두 가지 모드가 필요한가?

- 사용자 프로그램이 **시스템 자원(메모리, CPU, 디스크 등)** 을 직접 제어하면 **보안 문제** 및 **시스템 불안정** 유발
- 커널은 **중앙 통제**를 통해 자원 접근을 관리하고, 사용자는 **안전한 환경**에서 프로그램을 실행
- 커널 모드 → 모든 권한, 사용자 모드 → 제한된 권한  
  ⇒ **보안 + 안정성 확보**

---

## 3️⃣ 모드 전환 흐름

<pre><code>
[ 사용자 프로그램 실행 중 (User Mode) ]
         ↓
[ 시스템 콜 또는 인터럽트 발생 ]
         ↓
[ 커널 모드 진입 → 요청 처리 ]
         ↓
[ 결과 반환 → 사용자 모드 복귀 ]
</code></pre>

> 예: 파일 읽기 요청 → `read()` 호출 → 커널 모드로 전환 → 결과 반환

---

## 4️⃣ 시스템 콜과 모드 전환  

- 시스템 콜(System Call)은 **사용자 모드 → 커널 모드로 전환하는 공식 통로**
- 내부적으로는 `int 0x80`, `syscall`, `trap` 같은 CPU 명령어 사용

<pre><code class="language-c">
#include &lt;unistd.h&gt;

write(1, "Hello\n", 6);  // 사용자 모드 → 커널 모드 전환
</code></pre>

---

## 5️⃣ 예시 비교

| 항목        | 사용자 모드 예시                     | 커널 모드 예시                       |
|-------------|----------------------------------------|----------------------------------------|
| 앱 동작     | 브라우저, 메모 앱, 게임 등              | 없음 (커널 자체는 사용자 앱 아님)         |
| 함수 호출   | `strlen()`, `printf()` 등              | `read()`, `write()`, `fork()` 등 시스템 콜 |
| 자원 접근   | 메모리 일부만 접근 가능                  | 전체 메모리, 디스크, 네트워크 직접 접근 가능 |
| 안정성 영향 | 낮음 (앱 충돌 시 해당 앱만 종료)          | 높음 (오류 시 전체 시스템 다운 가능)       |

---

## 6️⃣ CPU 권한 레벨 (Ring 구조 참고)

| Ring Level | 설명                | 예시               |
|------------|---------------------|--------------------|
| Ring 0     | 커널 모드 (최고 권한)   | OS 커널, 드라이버 등 |
| Ring 3     | 사용자 모드 (최저 권한) | 일반 사용자 애플리케이션 |

> 대부분의 현대 OS는 Ring 0과 Ring 3만 사용

---

## 🎯 정리 요약

✔ 사용자 모드는 **일반 앱 실행용**, 제한된 권한  
✔ 커널 모드는 **운영체제 전반을 제어**, 전체 시스템 자원 접근 가능  
✔ **시스템 콜을 통해 두 모드가 전환**되며, 안전하게 커널 기능 사용  
✔ 이 구조는 **운영체제의 보안과 안정성 유지의 핵심** 메커니즘  
