# ⚙️ 운영체제 - 임계구역과 상호 배제

운영체제에서 **동시성 제어**는 매우 중요한 개념이며, 그 중심에 **임계구역(Critical Section)** 과 **상호 배제(Mutual Exclusion)** 가 있습니다.

---

## 1️⃣ 임계구역(Critical Section) 이란?

| 항목     | 설명 |
|----------|------|
| **정의** | 여러 프로세스/스레드가 공유 자원(데이터, 메모리 등)에 접근할 때, **동시에 접근하면 안 되는 코드 영역** |
| **예시** | 파일 쓰기, 전역 변수 수정, 입출력 장치 접근 등 |
| **문제** | 동시 접근 시 **데이터 충돌, 예기치 않은 결과** 발생 가능 |

---

## 2️⃣ 임계구역 문제 조건 (C.S. Problem 조건)

임계구역 문제를 해결하기 위한 **3가지 조건**:

| 조건            | 설명 |
|------------------|------|
| **상호 배제 (Mutual Exclusion)** | 한 번에 하나의 프로세스만 임계구역에 진입 가능 |
| **진행 (Progress)** | 임계구역에 진입할 프로세스가 없을 경우, **결정이 무한정 지연되지 않아야 함** |
| **한정 대기 (Bounded Waiting)** | 어떤 프로세스도 **무한정 기다리지 않도록 보장**해야 함 |

---

## 3️⃣ 상호 배제 (Mutual Exclusion)

| 항목 | 설명 |
|------|------|
| **정의** | 둘 이상의 프로세스가 **동시에 임계구역에 들어가지 못하도록 제어**하는 것 |
| **목적** | 데이터 무결성 유지, Race Condition 방지 |
| **방법** | 소프트웨어적 해결, 하드웨어 명령어, OS 지원 등 다양 |

---

## 4️⃣ 구현 방법

### 소프트웨어적 방법

| 알고리즘       | 특징 |
|----------------|------|
| **피터슨 알고리즘** | 두 개의 프로세스 간 상호 배제 보장 (이론적) |
| **Dekker’s 알고리즘** | 최초의 상호 배제 소프트웨어 알고리즘 |
| **Turn 변수, Flag 배열** | 번갈아가며 접근하도록 구현 |

### 하드웨어적 방법

| 명령어/방법       | 설명 |
|------------------|------|
| **Test-and-Set** | 원자적 연산으로 플래그 확인 및 설정 |
| **Swap**         | 변수 교환을 원자적으로 처리 |
| **Disable Interrupts** | 커널 수준에서 인터럽트 일시 중지 (단일 CPU 환경) |

### OS/언어 지원 방법

| 기법       | 설명 |
|------------|------|
| **Mutex (뮤텍스)** | 상호 배제를 위해 제공되는 객체 |
| **Semaphore (세마포어)** | 카운터 기반 동기화 도구 |
| **Monitor** | 고수준 언어에서 제공하는 동기화 구조 |
| **Lock/Unlock** | 임계구역 진입 전 lock, 종료 후 unlock |

---

## 5️⃣ Race Condition 이란?

| 항목 | 설명 |
|------|------|
| **정의** | 둘 이상의 프로세스가 **공유 자원에 동시에 접근**할 때, 실행 순서에 따라 결과가 달라지는 현상 |
| **예시** | 전역 변수 증가, 은행 계좌 입출금 처리 중 동시 접근 |
| **해결** | 임계구역 설정 및 **상호 배제 보장**으로 예방 가능 |

---

## 6️⃣ 예시 코드 (뮤텍스 기반 - C 스타일)

```c
pthread_mutex_t lock;

void* thread_function(void* arg) {
    pthread_mutex_lock(&lock);     // 🔒 임계구역 시작
    // 공유 자원 접근
    pthread_mutex_unlock(&lock);   // 🔓 임계구역 종료
}
```

---

## 🎯 정리 요약

✔ **임계구역은 공유 자원을 접근하는 코드 영역**  
✔ **상호 배제는 동시에 접근하지 못하도록 제어하는 기법**  
✔ 조건: 상호 배제, 진행, 한정 대기  
✔ 구현 방법: 소프트웨어, 하드웨어, OS 지원 방식  
✔ Race Condition은 동기화 실패로 발생, 반드시 예방 필요
