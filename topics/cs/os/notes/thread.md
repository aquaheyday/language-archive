# 🧵 스레드(Thread) 개념

**스레드는 프로세스 내에서 실행되는 흐름의 단위로, 하나의 프로세스 안에서 여러 스레드가 자원을 공유하며 동작할 수 있습니다.  
멀티스레딩을 통해 자원을 효율적으로 사용하면서 동시에 여러 작업을 수행할 수 있습니다.**

---

## 1️⃣ 스레드란?

| 항목       | 설명 |
|------------|------|
| 정의       | **프로세스 내에서 실행 흐름 단위 (Lightweight Process)** |
| 특징       | 코드, 데이터, 힙을 공유하며 독립적인 스택과 레지스터 보유 |
| 장점       | 문맥 전환 비용 ↓, 응답성 ↑, 자원 공유 용이 |
| 자원       | 스택, 레지스터 등 **일부만 독립**, 나머지는 **공유** |
| 역할       | 멀티태스킹, 비동기 처리, 병렬 실행 |

---

## 2️⃣ 프로세스 vs 스레드

| 항목       | 프로세스                       | 스레드                            |
|------------|--------------------------------|-----------------------------------|
| 정의       | 실행 중인 프로그램              | 프로세스 내 실행 흐름             |
| 자원       | 메모리, 파일 등 **모두 독립**    | 메모리 등 **대부분 공유**         |
| 생성 비용  | 상대적으로 높음                | 가벼움 (Lightweight)              |
| 안정성     | 하나 죽어도 다른 프로세스 영향 없음 | 하나의 스레드 오류 시 전체 프로세스 영향 가능 |
| 예시       | Chrome 전체 실행              | 각 탭, 렌더링 등 개별 스레드        |

---

## 3️⃣ 스레드 상태 전이

```
[ New (생성) ]
      ↓
[ Ready (준비 상태) ]
      ↓
[ Running (실행 중) ]
      ↓       ↑
[ Blocked (대기) ] ← (I/O, 동기화 등 대기)
      ↓
[ Terminated (종료) ]
```

> 스레드 스케줄러가 상태 전이를 제어하며, CPU는 하나의 스레드만 실행 가능

---

## 4️⃣ 스레드 메모리 구조

| 영역      | 공유 여부 | 설명 |
|-----------|-----------|------|
| Code      | 공유      | 프로그램 실행 코드 |
| Data      | 공유      | 전역 변수, static 변수 |
| Heap      | 공유      | 동적 할당된 메모리 |
| Stack     | **비공유** | 각 스레드의 함수 호출, 지역 변수 등 |
| Registers | **비공유** | 각 스레드의 CPU 상태 정보 |

---

## 5️⃣ 스레드 관련 함수 C언어 예시 (POSIX Threads)

```c
#include <pthread.h>

void* task(void* arg) {
    printf("Hello from thread\n");
    return NULL;
}

int main() {
    pthread_t tid;
    pthread_create(&tid, NULL, task, NULL);  // 스레드 생성
    pthread_join(tid, NULL);                 // 스레드 종료 대기
    return 0;
}
```

> `pthread_create()`, `pthread_join()`, `pthread_exit()` 등으로 스레드 제어

---

## 6️⃣ 사용자 vs 커널 스레드

| 항목       | 사용자 스레드                     | 커널 스레드                    |
|------------|-----------------------------------|--------------------------------|
| 관리 주체   | 사용자 수준 라이브러리             | 운영체제 커널                   |
| 문맥 전환   | 빠름 (커널 모드 전환 없음)         | 느림 (커널 모드 진입 필요)     |
| 시스템콜   | 직접 호출 불가                    | 직접 시스템 자원 접근 가능      |
| 예시       | Java, Python 스레드               | Linux Native Thread (LWP 등)   |

---

## 7️⃣ 멀티스레딩 장단점

| 장점                        | 단점                             |
|-----------------------------|----------------------------------|
| 응답성 향상                 | 스레드 간 동기화 필요            |
| 자원 효율적 사용             | 하나의 오류로 전체 종료 가능      |
| 병렬 처리 가능               | 디버깅 어려움                    |

---

## 🎯 정리 요약

✔ 스레드는 **프로세스 내 실행 흐름 단위**, 자원 공유로 효율적인 멀티태스킹 가능  
✔ **독립적인 Stack, 레지스터**와 **공유된 메모리 영역**을 활용  
✔ `pthread` 등으로 **스레드 생성, 실행, 종료** 가능  
✔ 스레드 간 충돌 방지를 위한 **동기화**가 중요  
✔ 프로세스보다 **가볍고 빠르지만**, 하나의 스레드 오류로 전체 영향 가능
