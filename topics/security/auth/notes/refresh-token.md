# 🔁 리프레시 토큰 (Refresh Token) 전략

**리프레시 토큰**은 **액세스 토큰(access token)** 이 만료된 후에도 사용자가 다시 로그인하지 않고 **새로운 토큰을 발급받을 수 있도록** 도와주는 토큰입니다.

> 액세스 토큰은 짧게, 리프레시 토큰은 길게 → 보안 + 사용자 경험 모두 만족

---

## 1️⃣ 왜 리프레시 토큰이 필요한가?

| 문제                  | 리프레시 토큰 도입 전             | 도입 후 효과                    |
|-----------------------|------------------------------------|---------------------------------|
| 액세스 토큰 짧은 만료 | 사용자는 자주 로그인이 끊김         | 리프레시 토큰으로 자동 연장 가능 |
| 토큰 탈취 리스크       | 긴 토큰 유효기간은 보안 위험 ↑      | 짧은 액세스 토큰 + 안전한 재발급 |
| 로그아웃 처리 어려움   | JWT는 서버 저장 없어서 무효화 어려움 | 리프레시 토큰만 무효화하면 해결 |

---

## 2️⃣ 토큰 구성과 수명 전략

| 토큰 종류       | 사용 목적           | 권장 만료 시간     | 저장 위치 추천      |
|------------------|----------------------|---------------------|----------------------|
| 액세스 토큰       | API 요청 인증         | 5~15분              | 메모리 / LocalStorage |
| 리프레시 토큰     | 새 토큰 발급용        | 7일~30일 이상       | **HttpOnly Cookie** 권장 |

---

## 3️⃣ 인증 흐름 예시

### 1) 로그인 시
1. 서버에서 액세스 토큰 + 리프레시 토큰 발급
2. 액세스 토큰 → 클라이언트 저장
3. 리프레시 토큰 → HttpOnly 쿠키에 저장 (XSS 방지)

---

### 2) 토큰 갱신 시
1. 액세스 토큰 만료 시 → `/refresh` 엔드포인트 호출
2. 서버는 쿠키의 리프레시 토큰 검증
3. 검증 성공 시 → 새 액세스 토큰 재발급

---

## 4️⃣ 리프레시 토큰 보안 전략

| 전략                          | 설명 |
|-------------------------------|------|
| ✅ HttpOnly + Secure 쿠키 사용   | JS 접근 차단 + HTTPS 전용 전송 |
| ✅ 토큰 저장소에서 관리 (DB 등)  | 리프레시 토큰 유효성 검증, 강제 무효화 가능 |
| ✅ 1회성 토큰 사용              | 재사용 방지 → 매번 새 토큰 발급 |
| ✅ 로그아웃 시 토큰 삭제        | 서버/DB에서 삭제하여 재사용 불가 처리 |
| ✅ IP/디바이스 정보 체크        | 토큰 재사용 탐지 시 차단 가능 |

---

## 5️⃣ 리프레시 토큰 관련 엔드포인트 예시

- `POST /login` → 액세스 + 리프레시 토큰 발급
- `POST /refresh` → 리프레시 토큰 사용하여 액세스 토큰 재발급
- `POST /logout` → 리프레시 토큰 무효화 처리

---

## 🎯 정리

✔ 리프레시 토큰 → **새 액세스 토큰을 위한 열쇠**  
✔ 액세스 토큰은 짧게, 리프레시 토큰은 길게 설정  
✔ 리프레시 토큰은 **HttpOnly + Secure 쿠키**에 저장  
✔ 재발급, 블랙리스트, 디바이스 확인 등 보안 전략 필수  
