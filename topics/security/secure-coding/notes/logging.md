# 🛡️ Secure Coding - 로깅과 민감 정보 보호

**로깅(logging)** 은 시스템의 동작 상태, 오류, 이벤트 등을 기록하여 운영 및 보안 분석에 활용되지만,  
**민감한 정보까지 로그에 기록될 경우** 공격자에게 **치명적인 정보 유출 경로**가 될 수 있습니다.

---

## 1️⃣ 민감 정보 로그 노출의 위험성

| 항목                | 설명 |
|---------------------|------|
| 비밀번호, 토큰 유출 | 인증 정보가 로그에 노출되면 계정 탈취 가능 |
| 개인정보(PII) 유출   | 이름, 전화번호, 이메일 등 노출 시 법적 문제 발생 |
| 금융정보 노출       | 카드번호, 계좌 등 유출 시 직접 피해 발생 |
| 내부 시스템 정보     | DB 쿼리, 경로, IP 등 노출 시 공격자에게 단서 제공 |

---

## 2️⃣ 로깅 시 민감 정보 보호 원칙

| 원칙                     | 설명 |
|--------------------------|------|
| 민감 정보는 로그에 기록하지 않음 | 비밀번호, 토큰, 카드번호 등 |
| 필드 마스킹 또는 제거           | 예: `"password": "***"` |
| 사용자 입력값은 필터링 후 기록  | 특히 API 요청/응답 로깅 시 |
| 디버그/개발 환경만 상세 로깅    | 운영 환경에서는 제한적으로 |
| 접근 제어 적용된 로그 저장소    | 로그 접근은 최소 권한자만 가능 |
| 로그 보관 기간 및 삭제 정책 유지 | 장기 저장 시 보안/법적 리스크 발생 가능 |

---

## 3️⃣ 민감 정보 예시 목록

| 유형       | 예시 |
|------------|------|
| 인증 정보   | 비밀번호, access_token, refresh_token |
| 개인정보   | 이름, 주민번호, 이메일, 전화번호, 주소 |
| 금융 정보   | 카드번호, 계좌번호, 거래내역 |
| 시스템 정보 | 내부 IP, DB 경로, 서버 경로, 스택트레이스 |

---

## 4️⃣ 예시: 안전한 로깅 처리

#### ❌ 잘못된 로그 예시

```json
{
  "email": "user@example.com",
  "password": "123456"
}
```

#### ✅ 안전한 로그 예시

```json
{
  "email": "user@example.com",
  "password": "***"
}
```

#### ✅ Express 미들웨어 예시 (필드 마스킹)

```js
app.use((req, res, next) => {
  const cloneBody = { ...req.body };
  if (cloneBody.password) cloneBody.password = "***";
  console.log("Request Body:", cloneBody);
  next();
});
```

---

## 5️⃣ 로깅 보안 체크리스트

- [ ] 비밀번호, 토큰, 주민번호 등이 로그에 남지 않도록 필터링/마스킹 적용
- [ ] API 요청/응답 로깅 시 민감 필드 제거
- [ ] 운영 환경에서는 DEBUG 레벨 로그 비활성화
- [ ] 로그 파일 접근 권한이 제한되어 있는가?
- [ ] 로그 파일 전송 시 암호화(TLS, VPN 등)가 적용되는가?
- [ ] 로그 보관 주기 및 삭제 정책이 수립되어 있는가?

---

## 6️⃣ 점검 도구

| 도구 | 설명 |
|------|------|
| `log-analyzer` | 로그에서 민감 패턴(주민번호, 카드번호 등) 탐지 |
| `grep` + 정규표현식 | CLI에서 직접 민감 정보 탐색 가능 |
| ELK / Grafana Loki | 중앙 집중형 로그 수집 시 필터링/마스킹 가능 |

---

## 🎯 정리

✔ 로깅은 보안에 필수지만, **기록된 내용이 공격자에게 무기가 될 수 있음**  
✔ 비밀번호, 토큰, 주민번호, 카드번호 등은 **절대 로그에 기록하지 말 것**  
✔ 마스킹, 필터링, 접근제어, 보관정책으로 **로그 보안 체계 구축**  
✔ 로그는 남기되, **필요한 만큼만, 안전하게**
