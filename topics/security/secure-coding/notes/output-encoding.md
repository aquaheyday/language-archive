# 🔐 Secure Coding - 출력 인코딩 (Output Encoding)

**출력 인코딩**은 사용자 입력값을 화면에 출력할 때, **브라우저가 해석하지 않도록 특수 문자를 안전하게 변환**하는 기법입니다.  
XSS(Cross-Site Scripting)와 같은 공격을 예방하는 데 핵심적인 보안 코딩 기술입니다.

---

## 1️⃣ 왜 출력 인코딩이 필요한가?

| 상황 | 설명 |
|------|------|
| 입력값 검증만 한 경우 | 공격자가 `<script>` 태그를 삽입해도 서버는 통과시킬 수 있음 |
| 출력 시 인코딩 없음 | 브라우저가 악성 코드를 실행할 수 있음 |
| 출력 시 인코딩 적용 | `<`, `>` 등의 특수 문자가 일반 문자로 처리되어 안전 |

---

## 2️⃣ 주요 개념

| 특수 문자 | HTML 인코딩 |
|-----------|--------------|
| `<`       | `&lt;`       |
| `>`       | `&gt;`       |
| `&`       | `&amp;`      |
| `"`       | `&quot;`     |
| `'`       | `&#039;`     |

- **출력 위치에 따라 인코딩 방식이 달라져야 함** (HTML, JS, URL, 속성 등)

---

## 3️⃣ 출력 인코딩 적용 위치별 예시

| 위치 | 인코딩 필요 여부 | 설명 |
|------|------------------|------|
| HTML 텍스트 영역 | ✅ 필요 | 사용자 입력을 그대로 출력하는 경우 |
| HTML 속성 값 | ✅ 필요 | `<input value="...">` |
| JavaScript 내 삽입 | ✅ 필요 | `var x = '...';` |
| URL 파라미터 | ✅ 필요 | 링크에 사용자 값 포함 시 |

---

## 4️⃣ 코드 예시

### 1) JavaScript – HTML 인코딩 함수

```js
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
```

---

### 2) 템플릿 엔진 활용 예시 (기본 자동 인코딩)

- **React JSX**  
  ```jsx
  <div>{userInput}</div>  // 자동 인코딩됨
  ```

- **Thymeleaf** (Spring)  
  ```html
  <span th:text="${userInput}"></span>
  ```

- **Handlebars / Mustache**  
  ```html
  {{userInput}}           <!-- HTML 이스케이프 자동 적용 -->
  ```

---

## 5️⃣ 출력 인코딩 테스트 예시

| 입력값 | 인코딩 전 출력 | 인코딩 후 출력 |
|--------|----------------|----------------|
| `<script>alert(1)</script>` | XSS 발생 위험 | 안전한 문자열 표시 (`&lt;script&gt;...`) |

---

## 6️⃣ 체크리스트

- [ ] 사용자 입력을 HTML/속성/JS에 출력하기 전에 반드시 인코딩
- [ ] 템플릿 엔진 기본 인코딩 기능 확인 및 우회 방지
- [ ] `innerHTML`, `document.write()` 등 직접 DOM 삽입 피하기
- [ ] JavaScript/URL/HTML 각각에 맞는 인코딩 방식 사용
- [ ] 사용자 입력을 절대 "신뢰된 콘텐츠"로 간주하지 않기

---

## 🎯 정리

✔ 출력 인코딩은 **"보이는 건 그대로, 실행은 안 되게"** 만드는 핵심 기법  
✔ 입력 검증과 함께 적용해야 실질적인 XSS 방지 가능  
✔ 템플릿 엔진의 자동 인코딩 여부를 항상 확인  
✔ HTML/속성/JS/URL 등 위치에 따라 맞는 방식으로 인코딩 필요
