# 🔄 JavaScript - 이벤트 루프(Event Loop)

자바스크립트는 **단일 스레드** 언어입니다.  
동시에 한 줄씩 코드만 실행할 수 있지만, **비동기 처리**를 가능하게 하는 핵심 구조가 바로 **이벤트 루프(Event Loop)** 입니다.

---

## 1️⃣ 실행 컨텍스트란?


코드가 실행되는 환경(상황, 문맥)에 대한 정보 모음, 자바스크립트 엔진이 코드를 해석하고 실행할 때 내부적으로 생성하는 객체  
즉, 자바스크립트가 코드를 "어떻게, 어떤 순서로" 실행할지 관리하는 시스템  

---

### 1) 실행 컨텍스트 안에는 뭐가 들어있을까?

| 구성 요소 | 설명 |
|------|------|
| 변수 환경(Variable Environment) |	변수, 함수 선언 저장 (초기 상태) |
| 렉시컬 환경(Lexical Environment) |	현재 스코프 정보 (변수, 상위 스코프 등) |
| `this` 바인딩 | 현재 컨텍스트에서의 this가 무엇인지 저장 |
| 스코프 체인 |	상위 컨텍스트와 연결된 구조 |

---

### 2) 실행 컨텍스트가 만들어지는 시점

#### 전역 컨텍스트

- 자바스크립트 코드가 처음 실행될 때 자동으로 생성
- 브라우저에선 window, Node.js에선 global이 this

#### 함수 컨텍스트

- 함수가 호출될 때마다 새로운 실행 컨텍스트가 생성됨

#### 예제

```js
const x = 10;

function foo() {
  const y = 20;
  console.log(x + y);
}

foo();
```

#### 실행 컨텍스트 생성 순서
1. 전역 실행 컨텍스트 생성 → x, foo 등록
2. foo() 호출 시, 새로운 함수 실행 컨텍스트 생성
3. foo 실행 → 내부 변수 y, this, 스코프 등 관리

---

## 2️⃣ 콜 스택(Call Stack)이란?

- 함수의 실행 순서를 관리하는 자료구조(스택)
- 자바스크립트는 단일 스레드 구조로 한 번에 하나의 함수만 실행할 수 있는데, 함수를 실행할 때마다 "콜 스택"에 쌓고, 끝나면 꺼내는 방식으로 실행 순서를 관리합니다.

---

### 1) "스택(Stack)"이 뭐더라?

LIFO (Last In, First Out), 나중에 들어간 게 가장 먼저 나오는 구조

| 동작 | 설명 |
|------|------|
| push() |	스택에 추가 (함수 호출 시) |
| pop() |	스택에서 제거 (함수 실행 완료 시) |

---

### 2) 콜 스택 동작 예제 

```js
function one() {
  two();
}
function two() {
  console.log("Hello");
}

one();
```

#### 실행 순서
1. one() 호출 → 콜 스택에 one push
2. two() 호출 → 콜 스택에 two push
3. console.log() 실행 → "Hello" 출력
4. two() 종료 → 콜 스택에서 two pop
5. one() 종료 → 콜 스택에서 one pop


---

## 3️⃣ 비동기 작업과 이벤트 큐

```js
console.log("Start");

setTimeout(() => {
  console.log("Timeout");
}, 0);

console.log("End");
```

#### 실행 순서:
1. Start 출력
2. setTimeout 등록 (콜백은 백그라운드로)
3. End 출력
4. 이벤트 루프가 콜백을 큐에서 꺼냄
5. Timeout 출력

#### 왜 "Timeout"이 나중에 출력되나? 

자바스크립트는 **비동기 함수의 콜백을 "이벤트 큐"에 넣고**, **콜 스택이 비면** 꺼내서 실행함

---

## 4️⃣ 이벤트 루프란?

**콜 스택이 비어 있는지 감시하다가**, **이벤트 큐에 대기 중인 작업이 있으면 꺼내서 실행하는 루프**

> 즉, 자바스크립트는 → 콜 스택이 비면 → 이벤트 큐에 있는 콜백을 하나 꺼내서 실행 → 또 반복...

이게 바로 **이벤트 루프(Event Loop)**

---

## 4️⃣ 태스크 큐 vs 마이크로태스크 큐

### 1) 큐 설명

자바스크립트에는 2종류의 큐가있습니다.  

| 종류 | 설명 | 예시 |
|------|------|------|
| **태스크 큐** (Task Queue) | setTimeout, setInterval 등 | `setTimeout(...)` |
| **마이크로태스크 큐** (Microtask Queue) | Promise, async/await, queueMicrotask 등 | `Promise.then(...)` |

✔ **마이크로태스크 큐가 우선순위가 더 높습니다**

---

### 2) 큐 예제

```js
console.log("1");

setTimeout(() => {
  console.log("2");
}, 0);

Promise.resolve().then(() => {
  console.log("3");
});

console.log("4");
```

#### 출력 결과:
```
1
4
3
2
```

✔ `Promise.then()`은 **마이크로태스크 큐**  
✔ `setTimeout`은 **태스크 큐**

#### 흐름 정리

1. 실행 컨텍스트가 콜 스택에 올라가서 실행됨
2. 비동기 콜백은 백그라운드 → 큐로 이동
3. 콜 스택이 비면 이벤트 루프가 큐에서 꺼내 실행
4. 마이크로태스크 큐 → 태스크 큐 순서로 실행

---

## 🎯 정리

| 개념 | 설명 |
|------|------|
| **콜 스택** | 현재 실행 중인 함수들이 쌓이는 공간 |
| **이벤트 큐** | 나중에 실행될 콜백 함수들이 대기하는 공간 |
| **이벤트 루프** | 콜 스택이 비면 큐에서 작업을 꺼내 실행 |
| **마이크로태스크 큐** | `Promise`, `async/await` 관련 큐 (우선순위 높음) |
| **비동기 처리의 핵심** | "이벤트 루프가 스택이 비면 큐에서 작업을 실행" |
