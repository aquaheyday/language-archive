# 🔐 PHP 세션과 쿠키

웹은 기본적으로 **HTTP 요청 간 상태를 유지하지 않는(stateless)** 구조입니다.  
사용자 로그인 상태나 장바구니 정보처럼 **사용자별 상태를 유지**하기 위해 PHP에서는 **세션(Session)** 과 **쿠키(Cookie)** 기능을 제공합니다.

---

## 1️⃣ 쿠키(Cookie)란?

쿠키는 **사용자 브라우저에 저장되는 작은 텍스트 정보**입니다.  
로그인 유지, 최근 본 상품 저장 등에 활용됩니다.

#### 1. 쿠키 생성

```php
<?php
setcookie("username", "alice", time() + 3600); // setcookie(쿠키 이름, 쿠키 값, 만료 시간): 1시간 후 만료
?>
```

#### 2. 쿠키 읽기

```php
<?php
if (isset($_COOKIE["username"])) {
    echo "환영합니다, " . $_COOKIE["username"] . "님!";
}
?>
```

✔ 쿠키는 HTTP 요청 시마다 서버에 자동으로 함께 전송됩니다.

---

## 2️⃣ 세션(Session)이란?

세션은 **서버에 저장되는 사용자별 정보 저장소**입니다.  
쿠키보다 보안성이 높고, 로그인 정보 저장 등에 자주 사용됩니다.

#### 1. 세션 시작

```php
<?php
session_start(); // 세션 사용 시 항상 가장 먼저 호출
?>
```

#### 2. 세션 변수 저장

```php
<?php
$_SESSION["user_id"] = 123;
$_SESSION["username"] = "alice";
?>
```

#### 3. 세션 변수 사용

```php
<?php
session_start();

echo $_SESSION["username"]; // alice
?>
```

---

## 3️⃣ 세션 종료 및 초기화

#### 1. 개별 변수 삭제

```php
<?php
unset($_SESSION["user_id"]);
?>
```

#### 2. 전체 세션 종료

```php
<?php
session_start();
session_unset();   // 모든 세션 변수 초기화
session_destroy(); // 세션 자체 제거
?>
```

✔ `session_destroy()` 호출 후에도 **세션 쿠키가 브라우저에 남아 있을 수 있으므로**, `setcookie()`를 함께 사용하여 쿠키도 제거하는 것이 좋습니다.

---

## 4️⃣ 쿠키 vs 세션 비교

| 항목       | 쿠키(Cookie)                             | 세션(Session)                             |
|------------|-------------------------------------------|-------------------------------------------|
| 저장 위치  | 클라이언트(브라우저)                    | 서버                                     |
| 보안성     | 낮음 (사용자가 직접 열람 가능)          | 높음 (서버에서만 관리)                   |
| 만료 시간  | 설정 가능 (`setcookie`)                 | 브라우저 종료 시 기본 만료              |
| 데이터 용량| 약 4KB 제한                              | 제한 없음 (서버 용량에 따라 다름)        |
| 사용 예시  | 자동 로그인, 간단한 상태 유지           | 로그인 인증, 장바구니, 사용자 정보 저장 |

---

## 5️⃣ 로그인 예제 간단 흐름

```php
// 로그인 성공 시
session_start();
$_SESSION["user_id"] = $user["id"];
$_SESSION["username"] = $user["name"];
```

```php
// 페이지 접근 시 인증 확인
session_start();
if (!isset($_SESSION["user_id"])) {
    header("Location: login.php");
    exit;
}
```

✔ 세션을 이용하면 로그인 여부를 다양한 페이지에서 **간편하게 확인**할 수 있습니다.

---

## 🎯 정리

✔ 쿠키는 사용자 브라우저에 저장되며, 클라이언트 쪽에서 데이터를 보관할 수 있습니다.  
✔ 세션은 서버에 저장되며, 보안이 필요한 로그인 정보 등에 적합합니다.  
✔ 쿠키는 `setcookie()`, 세션은 `$_SESSION`을 통해 사용합니다.  
✔ `session_start()`는 세션 사용 시 **항상 맨 위에 위치**해야 합니다.  
✔ 세션 종료 시에는 `session_unset()`과 `session_destroy()`를 함께 사용합니다.

